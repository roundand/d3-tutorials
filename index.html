<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Page Template</title>
        <script type="text/javascript" src="d3/d3.js"></script>
        <style>
        div.bar {
            display: inline-block;
            width: 20px;
            height: 75px;   /* We'll override height later */
            background-color: teal;
            margin-right: 2px;
        }
        </style>
    </head>
    <body>
        <script type="text/javascript">
            var h = 100;
            var w = 500;
            var padding = 1;

            var svg = d3.select('body')
                        .append('svg')
                        .attr('width', w)
                        .attr('height', h);
                        

            // fetch the csv file and generate SVG in the callback
            d3.csv("data/fruit.csv", pictureThis);

            // callback to generate SVG barchart
            function pictureThis(data){
                console.log(data);
                
                // scaling factors to fit data into our SVG window of h * w
                var width = w / data.length;                                    // to fit each bar+padding.
                var maxHeight = data.reduce(function(soFar, item){              // for each item in data, call function ...
                                    return Math.max(item.Deliciousness, soFar); // ... to compare value to max so far
                                }, 0);                                          // ... (initial value for soFar is 0)
                var heightScaling = h / maxHeight;                              // ... giving us our vertical scaling factor.
                
                var bars = svg.selectAll('rect')                                // find all svg/rect ...
                    .data(data)                                                 // ... and all data items 
                    .enter()                                                    // ... and for all unmatched items
                    .append('rect');                                            // ... create a new, matching svg/rect.
                
                bars.attr('x', function(d, i){                                  // for each bar, set x ...
                        return (i * (width));
                    })
                    .attr('y', function(d){                                     // ... and y. But SVG uses top-left origin ...
                        return h - (heightScaling * d.Deliciousness);           // ... so we adjust for bottom-left chart origin ...
                    })
                    .attr('height', function(d){                                // ... so that all bars are bottom-aligned...
                        return heightScaling * d.Deliciousness;
                    })
                    .attr('width', width - padding)                             // ... and have the right width.
                    .attr('fill', 'teal');

                var labels = svg.selectAll('text')                                // find all svg/text ...
                    .data(data)                                                 // ... and all data items 
                    .enter()                                                    // ... and for all unmatched items
                    .append('text');                                            // ... create a new, matching svg/text.
                
                labels.attr('x', function(d, i){                                  // for each label, set x ...
                        return (i * (width) + (width / 2));
                    })
                    .attr('y', function(d){                                     // ... and y. Flip y as before ...
                        return Math.min(h-15, h + 15 - (heightScaling * d.Deliciousness));
                    })
                    .text(function(d){                                          // ... and set the label text ...
                        return d.Food;
                    })
                    .attr('width', width - padding)                             // ... and have the right width.
                    .attr('font-family', 'sans-serif')
                    .attr('font-size', '11px')
                    .attr('fill', 'red')
                    .attr('text-anchor', 'middle');

            }
        </script>
    </body>
</html>